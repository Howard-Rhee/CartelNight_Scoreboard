<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>카르텔 볼더링 점수판</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<style>
body{
  margin:0;padding:0;
  font-family:'Noto Sans KR',sans-serif;
  background:#f2ebd9;overflow-x:hidden;position:relative;
}
body:before{
  content:"";position:fixed;top:0;left:0;width:100%;height:100%;
  background-image:radial-gradient(rgba(0,0,0,0.045)1px,transparent 1px),
                    radial-gradient(rgba(0,0,0,0.02)1px,transparent 1px);
  background-size:4px 4px,6px 6px;opacity:.45;pointer-events:none;z-index:0;
}
.logo{width:160px;display:block;margin:40px auto 5px;z-index:2;position:relative;}
h1{text-align:center;font-size:32px;margin:20px 0 30px;font-family:'Baloo 2';color:#3a2e1f;z-index:2;position:relative;}
#resetBtn,#resetLogBtn{
  position:fixed;top:18px;padding:12px 18px;border:none;border-radius:14px;
  color:white;font-weight:bold;cursor:pointer;z-index:10;
  box-shadow:2px 4px 10px rgba(0,0,0,0.25);
}
#resetBtn{right:24px;background:#ff4d4d;}
#resetLogBtn{right:160px;background:#ff8f2f;}
.holder-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;}
.holder{position:absolute;width:70px;opacity:.85;}
.team-box{
  background:#f7f1df;width:86%;margin:25px auto;padding:20px;
  border-radius:22px;box-shadow:2px 4px 10px rgba(0,0,0,.25);position:relative;z-index:2;
}
.team-box:before{
  content:"";position:absolute;top:0;left:0;width:100%;height:100%;
  border-radius:22px;opacity:.3;
  background:radial-gradient(rgba(0,0,0,0.06)1px,transparent 1px);background-size:4px 4px;
}
button{padding:10px 14px;border:none;border-radius:10px;color:white;cursor:pointer;font-size:15px;margin-left:6px;}
.add-btn{background:#4b7bff;} .add-btn:hover{background:#2f5fff;}
.minus-btn{background:#ff6b6b;} .minus-btn:hover{background:#d94343;}
.score-table{
  width:86%;margin:40px auto;background:#f7f1df;border-radius:18px;
  box-shadow:2px 4px 10px rgba(0,0,0,.25);overflow:hidden;z-index:2;position:relative;
}
.score-table th,.score-table td{padding:15px;font-size:18px;border-bottom:1px solid #e2d8bf;text-align:center;}
.score-table th{font-size:20px;background:#e5d9b6;font-weight:bold;color:#3a2e1f;}
.log-toggle{
  position:fixed;bottom:25px;left:50%;transform:translateX(-50%);
  padding:12px 22px;background:#ffb66e;border-radius:40px;cursor:pointer;
  font-weight:bold;z-index:10;box-shadow:0 3px 8px rgba(0,0,0,.25);font-size:17px;
}
.log-panel{
  position:fixed;bottom:0;left:0;width:100%;height:55%;background:#f7e9ca;
  border-radius:24px 24px 0 0;transform:translateY(100%);transition:.45s;
  padding:25px;overflow-y:auto;box-shadow:0 -4px 10px rgba(0,0,0,.25);z-index:20;
}
.log-panel.open{transform:translateY(0);}
.log-close{
  position:absolute;right:20px;top:18px;background:#ff6b6b;color:white;
  border:none;padding:6px 12px;border-radius:8px;cursor:pointer;font-weight:bold;
}
.log-item{
  background:#fff;padding:12px;margin:12px 0;border-radius:14px;
  box-shadow:2px 4px 8px rgba(0,0,0,.2);font-size:16px;
}
</style>
</head>

<body>

<img src="logo.jpg" class="logo">
<h1>카르텔 볼더링 대관파티 – 실시간 점수판</h1>

<button id="resetLogBtn" onclick="resetLogs()">로그 초기화</button>
<button id="resetBtn" onclick="resetScores()">전체 점수 초기화</button>

<div id="holderBackground" class="holder-bg"></div>
<div id="teams"></div>

<table class="score-table">
<thead><tr><th>팀</th><th>총점</th></tr></thead>
<tbody id="summary"></tbody>
</table>

<div class="log-toggle" onclick="toggleLog()">LOG</div>

<div class="log-panel" id="logPanel">
  <button class="log-close" onclick="toggleLog()">닫기</button>
  <h2>입력 로그</h2>
  <div id="logList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDSsqSSH_WSTIG17zgfsJiKpx4TtsiLPGQ",
  authDomain:"cartelscore-a2473.firebaseapp.com",
  databaseURL:"https://cartelscore-a2473-default-rtdb.firebaseio.com",
  projectId:"cartelscore-a2473",
  storageBucket:"cartelscore-a2473.firebasestorage.app",
  messagingSenderId:"645482608954",
  appId:"1:645482608954:web:0ef0b32cbd9cf135207803"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const holders=[
`<svg width="70" height="45" viewBox="0 0 60 40"><path d="M10 30 Q5 15 20 10 Q40 5 50 20 Q45 35 25 35 Z" fill="#b98cff" stroke="black" stroke-width="3"/></svg>`,
`<svg width="70" height="45" viewBox="0 0 60 40"><path d="M8 28 Q5 15 18 12 Q35 10 48 18 Q50 30 30 33 Z" fill="#ffe57f" stroke="black" stroke-width="3"/></svg>`,
`<svg width="70" height="45" viewBox="0 0 60 40"><path d="M12 30 Q5 18 15 8 Q35 5 48 15 Q45 32 28 34 Z" fill="#8fe27e" stroke="black" stroke-width="3"/></svg>`,
`<svg width="70" height="45" viewBox="0 0 60 40"><path d="M10 26 Q12 10 30 8 Q48 10 46 26 Q35 34 20 32 Z" fill="#6ea8ff" stroke="black" stroke-width="3"/></svg>`
];

function placeHolders(){
  const bg=document.getElementById("holderBackground");
  for(let i=0;i<26;i++){
    const h=document.createElement("div");
    h.className="holder";
    h.innerHTML=holders[Math.floor(Math.random()*holders.length)];
    h.style.left=Math.random()*95+"%";
    h.style.top=Math.random()*95+"%";
    h.style.transform=`rotate(${Math.random()*360}deg) scale(${0.6+Math.random()*0.7})`;
    bg.appendChild(h);
  }
}
placeHolders();

const scoreMap={"노랑":5,"초록":10,"하늘":20,"파랑":40,"보라":60,"회색":90,"갈색":120,"검은색":200};
const levels=Object.keys(scoreMap);
const teams=["A","B","C","D","E","F"];

const teamsContainer=document.getElementById("teams");

teams.forEach(team=>{
  const box=document.createElement("div");
  box.className="team-box";
  box.innerHTML=`
    <h2>${team}팀</h2>
    <select id="${team}_level" style="font-size:16px;padding:6px 10px;border-radius:8px;">
      ${levels.map(l=>`<option value="${l}">${l}</option>`).join("")}
    </select>
    <button class="add-btn" onclick="addScore('${team}')">점수 추가</button>
    <button class="minus-btn" onclick="minusScore('${team}')">점수 차감</button>
  `;
  teamsContainer.appendChild(box);
});

function addScore(team){
  const lv=document.getElementById(team+"_level").value;
  const p=scoreMap[lv];
  db.ref("scores/"+team).once("value").then(s=>{
    const v=s.val()||0;
    db.ref("scores/"+team).set(v+p);
    addLog(team,"add",lv,p);
  });
}

function minusScore(team){
  const lv=document.getElementById(team+"_level").value;
  const p=scoreMap[lv];
  db.ref("scores/"+team).once("value").then(s=>{
    let v=s.val()||0;
    v=Math.max(0,v-p);
    db.ref("scores/"+team).set(v);
    addLog(team,"minus",lv,p);
  });
}

db.ref("scores").on("value",snap=>{
  const tbody=document.getElementById("summary");
  tbody.innerHTML="";
  const sc=snap.val()||{};
  teams.forEach(t=>{
    tbody.innerHTML += `<tr><td><b>${t}</b></td><td>${sc[t]||0}</td></tr>`;
  });
});

function resetScores(){
  const pw=prompt("관리자 비밀번호:");
  if(pw!=="cartel123") return alert("비밀번호 틀림!");
  teams.forEach(t=>db.ref("scores/"+t).set(0));
  db.ref("logs").remove();
  alert("점수/로그 초기화 완료!");
}

function resetLogs(){
  const pw=prompt("로그 초기화 비밀번호:");
  if(pw!=="cartel123") return alert("틀림!");
  db.ref("logs").remove();
  alert("로그만 초기화 완료!");
}

function addLog(team,action,level,point){
  db.ref("logs").push({
    team,action,level,point,
    time:new Date().toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})
  });
}

function toggleLog(){
  document.getElementById("logPanel").classList.toggle("open");
}

db.ref("logs").on("value",snap=>{
  const list=document.getElementById("logList");
  list.innerHTML="";
  const logs=snap.val()||{};
  Object.values(logs).reverse().forEach(l=>{
    const sign=l.action==="add"?
      `<span style='color:green;font-weight:bold;'>+${l.point}</span>`:
      `<span style='color:red;font-weight:bold;'>-${l.point}</span>`;
    list.innerHTML+=`
      <div class="log-item">
        <b>${l.team}팀</b> — ${sign}<br>
        ${l.level}<br>
        <small>${l.time}</small>
      </div>`;
  });
});
</script>

</body>
</html>
