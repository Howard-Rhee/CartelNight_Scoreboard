<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>카르텔 볼더링 점수판</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">

<style>

/* ============================================================
   GLOBAL PAPER TEXTURE BACKGROUND (종이 질감)
   ============================================================ */
body{
  margin:0;
  padding:0;
  background:#f1e8d2;
  font-family:'Noto Sans KR',sans-serif;
  overflow-x:hidden;
  position:relative;
}

body:before{
  content:"";
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  background-image:
      radial-gradient(rgba(0,0,0,0.05) 1px, transparent 1px),
      radial-gradient(rgba(0,0,0,0.03) 1px, transparent 1px);
  background-size:4px 4px, 7px 7px;
  opacity:0.55;
  z-index:0;
}

/* ============================================================
   LOGO + TITLE 영역
   ============================================================ */
.logo{
  width:160px;
  display:block;
  margin:40px auto 10px auto;
  position:relative;
  z-index:3;
}

h1{
  text-align:center;
  font-family:'Baloo 2';
  font-size:32px;
  color:#3c3024;
  margin-bottom:40px;
  position:relative;
  z-index:3;
}

/* ============================================================
   HEADER BUTTONS
   ============================================================ */
#resetBtn, #resetLogBtn{
  position:fixed;
  top:18px;
  padding:12px 20px;
  border:none;
  border-radius:14px;
  color:white;
  font-weight:bold;
  cursor:pointer;
  z-index:20;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
}
#resetBtn{
  right:25px;
  background:#ff4d4d;
}
#resetLogBtn{
  right:150px;
  background:#ffa042;
}

/* ============================================================
   BACKGROUND HOLDERS (SVG)
   ============================================================ */
.holder-bg{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  pointer-events:none;
  z-index:1;
}
.holder{
  position:absolute;
  width:90px;
  opacity:0.9;
  filter:drop-shadow(2px 4px 4px rgba(0,0,0,0.3));
}

/* ============================================================
   TEAM CARD — REDESIGN (돌조각 느낌)
   ============================================================ */
.team-box{
  width:70%;
  margin:30px auto;
  background:#f8f1dc;
  border-radius:26px;
  padding:22px;
  position:relative;
  z-index:4;
  box-shadow:
     3px 5px 12px rgba(0,0,0,0.2),
     inset 0 0 6px rgba(255,255,255,0.6);
}

.team-box:before{
  content:"";
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  border-radius:26px;
  background:
     radial-gradient(rgba(0,0,0,0.05)1px, transparent 1px) repeat;
  background-size:5px 5px;
  opacity:0.25;
}

.team-box h2{
  margin:0 0 12px 0;
  font-size:23px;
  font-weight:700;
  color:#3c3024;
}

/* ============================================================
   SELECT + BUTTONS
   ============================================================ */
select{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid #bbb09a;
  font-size:16px;
}

button.add-btn{
  background:#4b7bff;
  font-size:15px;
  border:none;
  border-radius:10px;
  padding:10px 14px;
  color:white;
  cursor:pointer;
  margin-left:6px;
  box-shadow:0 3px 6px rgba(0,0,0,0.25);
}
button.add-btn:hover{ background:#224fff; }

button.minus-btn{
  background:#ff6b6b;
  font-size:15px;
  border:none;
  border-radius:10px;
  padding:10px 14px;
  color:white;
  cursor:pointer;
  margin-left:6px;
  box-shadow:0 3px 6px rgba(0,0,0,0.25);
}
button.minus-btn:hover{ background:#d64d4d; }

/* ============================================================
   SCORE TABLE (총점)
   ============================================================ */
.score-table{
  width:70%;
  margin:60px auto;
  background:#f8f1dc;
  border-radius:26px;
  box-shadow:
     3px 5px 12px rgba(0,0,0,0.2),
     inset 0 0 6px rgba(255,255,255,0.6);
  overflow:hidden;
}

.score-table th, .score-table td{
  padding:16px;
  font-size:18px;
  text-align:center;
  border-bottom:1px solid #e8ddc1;
}
.score-table th{
  background:#e9dcbe;
  font-size:20px;
  color:#3c3024;
}

/* ============================================================
   LOG BUTTON (BOTTOM)
   ============================================================ */
.log-toggle{
  position:fixed;
  bottom:25px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 20px;
  background:#ffa042;
  border-radius:40px;
  cursor:pointer;
  font-weight:bold;
  box-shadow:0 3px 8px rgba(0,0,0,0.25);
  z-index:30;
}

/* ============================================================
   LOG PANEL (SLIDE UP)
   ============================================================ */
.log-panel{
  position:fixed;
  bottom:0; left:0;
  width:100%;
  height:55%;
  background:#f8e7c0;
  border-radius:26px 26px 0 0;
  transform:translateY(100%);
  transition:0.45s;
  padding:25px;
  overflow-y:auto;
  box-shadow:0 -4px 12px rgba(0,0,0,0.25);
  z-index:50;
}

.log-panel.open{
  transform:translateY(0);
}

.log-close{
  position:absolute;
  right:20px;
  top:18px;
  background:#ff6b6b;
  padding:6px 14px;
  border:none;
  border-radius:10px;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.log-item{
  background:white;
  padding:14px;
  border-radius:14px;
  margin:12px 0;
  box-shadow:2px 4px 8px rgba(0,0,0,0.2);
  font-size:15px;
}

</style>
</head>

<body>

<img src="logo.jpg" class="logo">
<h1>카르텔 볼더링 대관파티 – 실시간 점수판</h1>

<button id="resetLogBtn">로그 초기화</button>
<button id="resetBtn">전체 점수 초기화</button>

<div id="holderBackground" class="holder-bg"></div>

<div id="teams"></div>

<table class="score-table">
<thead>
<tr><th>팀</th><th>총점</th></tr>
</thead>
<tbody id="summary"></tbody>
</table>

<div class="log-toggle" onclick="toggleLog()">LOG</div>

<div class="log-panel" id="logPanel">
  <button class="log-close" onclick="toggleLog()">닫기</button>
  <h2>입력 로그</h2>
  <div id="logList"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ============================================================
//  FIREBASE INIT
// ============================================================
const firebaseConfig = {
  apiKey: "AIzaSyDSsqSSH_WSTIG17zgfsJiKpx4TtsiLPGQ",
  authDomain: "cartelscore-a2473.firebaseapp.com",
  databaseURL: "https://cartelscore-a2473-default-rtdb.firebaseio.com",
  projectId: "cartelscore-a2473",
  storageBucket: "cartelscore-a2473.firebasestorage.app",
  messagingSenderId: "645482608954",
  appId: "1:645482608954:web:0ef0b32cbd9cf135207803",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ============================================================
//  SVG HOLDERS (REDESIGN)
// ============================================================
const holders = [
`<svg width="90" height="60" viewBox="0 0 60 40"><path d="M10 30 Q5 15 20 10 Q40 5 50 20 Q45 35 25 35 Z" fill="#b98cff" stroke="black" stroke-width="3"/></svg>`,
`<svg width="90" height="60" viewBox="0 0 60 40"><path d="M8 28 Q5 15 18 12 Q35 10 48 18 Q50 30 30 33 Z" fill="#ffe57f" stroke="black" stroke-width="3"/></svg>`,
`<svg width="90" height="60" viewBox="0 0 60 40"><path d="M12 30 Q5 18 15 8 Q35 5 48 15 Q45 32 28 34 Z" fill="#8fe27e" stroke="black" stroke-width="3"/></svg>`,
`<svg width="90" height="60" viewBox="0 0 60 40"><path d="M10 26 Q12 10 30 8 Q48 10 46 26 Q35 34 20 32 Z" fill="#6ea8ff" stroke="black" stroke-width="3"/></svg>`
];

// ============================================================
//  PLACE HOLDERS ON BACKGROUND (MORE, BIGGER, BETTER)
// ============================================================
function placeHolders(){
  const bg = document.getElementById("holderBackground");
  for(let i=0; i<45; i++){
    const h = document.createElement("div");
    h.className = "holder";
    h.innerHTML = holders[Math.floor(Math.random()*holders.length)];
    h.style.left = Math.random()*95 + "%";
    h.style.top = Math.random()*95 + "%";
    h.style.transform =
      `rotate(${Math.random()*360}deg) scale(${0.7 + Math.random()*0.8})`;
    bg.appendChild(h);
  }
}
placeHolders();

// ============================================================
// 점수표
// ============================================================
const scoreMap = {
  "노랑": 5,
  "초록": 10,
  "하늘": 20,
  "파랑": 40,
  "보라": 60,
  "회색": 90,
  "갈색": 120,
  "검은색": 200
};

const levels = Object.keys(scoreMap);
const teams = ["A","B","C","D","E","F"];

const teamsContainer = document.getElementById("teams");

// ============================================================
// TEAM CARD AUTO GENERATE
// ============================================================
teams.forEach(team=>{
  const box = document.createElement("div");
  box.className = "team-box";

  box.innerHTML = `
    <h2>${team}팀</h2>

    <select id="${team}_level">
      ${levels.map(l => `<option value="${l}">${l}</option>`).join("")}
    </select>

    <button class="add-btn" onclick="addScore('${team}')">점수 추가</button>
    <button class="minus-btn" onclick="minusScore('${team}')">점수 차감</button>
  `;

  teamsContainer.appendChild(box);
});

// ============================================================
// ADD SCORE
// ============================================================
function addScore(team){
  const lv = document.getElementById(team + "_level").value;
  const p = scoreMap[lv];

  db.ref("scores/" + team).once("value").then(snap=>{
    const current = snap.val() || 0;
    db.ref("scores/" + team).set(current + p);

    addLog(team, "add", lv, p);
  });
}

// ============================================================
// MINUS SCORE
// ============================================================
function minusScore(team){
  const lv = document.getElementById(team + "_level").value;
  const p = scoreMap[lv];

  db.ref("scores/" + team).once("value").then(snap=>{
    let current = snap.val() || 0;
    let updated = current - p;
    if(updated < 0) updated = 0;

    db.ref("scores/" + team).set(updated);

    addLog(team, "minus", lv, p);
  });
}

// ============================================================
// SUMMARY TABLE — REALTIME UPDATE
// ============================================================
db.ref("scores").on("value", snap=>{
  const tbody = document.getElementById("summary");
  tbody.innerHTML = "";

  const scores = snap.val() || {};

  teams.forEach(team=>{
    const score = scores[team] || 0;

    tbody.innerHTML += `
      <tr>
        <td><b>${team}</b></td>
        <td>${score}</td>
      </tr>
    `;
  });
});

// ============================================================
// RESET SCORES (PASSWORD)
// ============================================================
function resetScores(){
  const pw = prompt("관리자 비밀번호:");
  if(pw !== "cartel123"){
    alert("비밀번호 오류!");
    return;
  }

  teams.forEach(team=>{
    db.ref("scores/" + team).set(0);
  });

  db.ref("logs").remove();

  alert("전체 점수 & 로그 초기화됨!");
}
</script>

<script>
// ============================================================
// ADD LOG
// ============================================================
function addLog(team, action, level, point){
  db.ref("logs").push({
    team: team,
    action: action,
    level: level,
    point: point,
    time: new Date().toLocaleTimeString("ko-KR", {
      hour:"2-digit",
      minute:"2-digit",
      second:"2-digit"
    })
  });
}

// ============================================================
// TOGGLE LOG PANEL
// ============================================================
function toggleLog(){
  document.getElementById("logPanel").classList.toggle("open");
}

// ============================================================
// LOG REALTIME UPDATE
// ============================================================
db.ref("logs").on("value", snap=>{
  const list = document.getElementById("logList");
  list.innerHTML = "";

  const logs = snap.val() || {};

  const items = Object.values(logs).reverse();

  items.forEach(l=>{
    const sign = l.action === "add"
      ? `<span style="color:green;font-weight:bold;">+${l.point}</span>`
      : `<span style="color:red;font-weight:bold;">-${l.point}</span>`;

    list.innerHTML += `
      <div class="log-item">
        <b>${l.team}팀</b> — ${sign}<br>
        ${l.level}<br>
        <small>${l.time}</small>
      </div>
    `;
  });
});

// ============================================================
// RESET LOGS ONLY (PASSWORD)
// ============================================================
function resetLogs(){
  const pw = prompt("로그 초기화 비밀번호:");
  if(pw !== "cartel123"){
    alert("잘못된 비밀번호입니다.");
    return;
  }
  db.ref("logs").remove();
  alert("로그만 초기화 완료!");
}
</script>

</body>
</html>

